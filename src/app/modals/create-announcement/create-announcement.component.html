<section class="form-section container" [formGroup]="announcementForm">
    <div class="form-header">
        <h3>Create Announcement</h3>
        <i class="fa-solid fa-xmark" (click)="closeModal()"></i>
    </div>

    <div class="form-body">

        <!-- Category -->
        <div class="inp-cont">
            <label class="medium-font">Category <span class="required">*</span></label>
            <div class="category-options">
                <label class="medium-font regular-font">
                    <input type="radio" value="announcements" formControlName="category"
                        (change)="onCategoryChange()" />
                    Announcements
                </label>
                <label class="medium-font regular-font">
                    <input type="radio" value="events" formControlName="category" (change)="onCategoryChange()" />
                    Events
                </label>
                <label class="medium-font regular-font">
                    <input type="radio" value="updates" formControlName="category" (change)="onCategoryChange()" />
                    Updates
                </label>
            </div>
            <small class="error-text regular-font" *ngIf="f['category'].touched && f['category'].invalid">
                Please select a category.
            </small>
        </div>

        <!-- Event Date (Visible only if category === 'Events') -->
        <div class="inp-cont" *ngIf="announcementForm.get('category')?.value === 'events'">
            <label class="medium-font">Event Date <span class="required">*</span></label>
            <input type="date" class="inp-cus regular-font" formControlName="event_date" />
            <small class="error-text regular-font" *ngIf="f['event_date'].touched && f['event_date'].invalid">
                Event date is required for Events.
            </small>
        </div>

        <!-- Title -->
        <div class="inp-cont">
            <label class="medium-font">Title <span class="required">*</span></label>
            <input type="text" class="inp-cus regular-font" placeholder="Enter title" formControlName="title" />
            <small class="error-text regular-font" *ngIf="f['title'].touched && f['title'].invalid">
                Title is required.
            </small>
        </div>

        <!-- Summary -->
        <div class="inp-cont">
            <label class="medium-font">Summary <span class="required">*</span></label>
            <textarea class="inp-cus regular-font" rows="4" placeholder="Enter summary..." formControlName="summary"></textarea>
            <small class="error-text regular-font" *ngIf="f['summary'].touched && f['summary'].invalid">
                Summary is required.
            </small>
        </div>

        <!-- Attachments -->
        <div class="inp-cont">
            <label class="medium-font">Attachments (Max 2 files — image or video)</label>
            <input type="file" class="inp-cus regular-font" (change)="onFileSelected($event)" multiple accept="image/*,video/*" />

            <!-- Preview -->
            <div class="preview-container" *ngIf="previewFiles.length > 0">
                <div class="preview-item" *ngFor="let file of previewFiles; let i = index">

                    <!-- Image Preview -->
                    <img *ngIf="file.type === 'image'" [src]="file.url" />

                    <!-- Video Preview -->
                    <video *ngIf="file.type === 'video'" [src]="file.url" controls width="150">
                    </video>

                    <span class="remove-btn" (click)="removeAttachment(i)">×</span>
                </div>
            </div>
        </div>


        <!-- Footer Actions -->
        <div class="popup-actions">
            <button class="cancel-btn" type="button" (click)="closeModal()">Cancel</button>
            <button class="delete-btn" type="button" (click)="submitAnnouncement()"
                [disabled]="announcementForm.invalid" *ngIf="!showprocessingbtn">
                Post
            </button>
            <button class="delete-btn" type="button" *ngIf="showprocessingbtn" style="cursor: not-allowed;">
                Posting...
            </button>
        </div>
    </div>
</section>