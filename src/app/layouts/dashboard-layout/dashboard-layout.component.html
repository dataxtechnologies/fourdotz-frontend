<section *ngIf="user_type === 'association' && loadingUserData" class="loader-section">
    <img src="assets/logo/fourdotz-logo.png" alt="Loading..." class="loader-img" />
</section>

<header class="navbar-header-main" *ngIf="!loadingUserData">
    <div class="navbar-header">
        <div class="user-greeting">
            <div class="user-image">
                <img src="assets/logo/fourdotz1.png" alt="User Icon" />
            </div>
            <div class="greeting-text">
                <h3 class="user-name">Hello, {{ user_type }}!</h3>
            </div>
        </div>

        <div class="navbar-actions">
            <div class="notification-icons">
                <button class="icon-btn" (click)="profileredirect()">
                    <img src="/assets/icons/profile.svg" alt="">
                </button>
            </div>
        </div>
    </div>
</header>

<!-- Layout wrapper -->
<div class="layout">

    <!-- Sidebar -->
    <nav id="sidebar" [class.close]="sidebarClosed">

        <ul class="menu-list">

            <!-- NEW: toggle button visible only when collapsed -->
            <li class="toggle-btn-li" *ngIf="sidebarClosed">
                <button (click)="toggleSidebar()" id="toggle-btn-mini">
                    <i class="fa-solid fa-bars"></i>
                </button>
            </li>

            <!-- Sidebar Menu Items -->
            <ng-container *ngFor="let item of sidebarItems">

                <!-- If item has submenu -->
                <li *ngIf="item.children && item.allowedRole === user_type" class="submenu">

                    <div class="submenu-title d-flex justify-content-between align-items-center"
                        (click)="item.open = !item.open">

                        <img [src]="item.icon" class="icon-img me-2">

                        <!-- Hide label only -->
                        <span class="mx-1" *ngIf="!sidebarClosed">{{ item.label }}</span>

                        <!-- Show toggle ALWAYS -->
                        <i class="fa-solid" style="font-size: 12px;"
                            [ngClass]="item.open ? 'fa-chevron-up' : 'fa-chevron-down'">
                        </i>
                    </div>

                    <!-- Submenu (expanded mode + collapsed mode) -->
                    <ul class="submenu-list mx-4" *ngIf="item.open" [class.floating-submenu]="sidebarClosed">

                        <li *ngFor="let child of item.children" routerLinkActive="active">
                            <a [routerLink]="child.route" class="d-flex align-items-center">
                                <img [src]="child.icon" class="subicon-img1 me-2">

                                <!-- LABEL HIDDEN ONLY WHEN COLLAPSED -->
                                <span *ngIf="!sidebarClosed">{{ child.label }}</span>
                            </a>
                        </li>

                    </ul>

                </li>

                <!-- Normal menu items -->
                <li *ngIf="!item.children && item.allowedRole === user_type" routerLinkActive="active"
                    [class.active]="item.route === currentRoute">

                    <a [routerLink]="item.route" class="d-flex align-items-center">
                        <img [src]="item.icon" class="icon-img me-2">
                        <span *ngIf="!sidebarClosed">{{ item.label }}</span>
                    </a>
                </li>

            </ng-container>

        </ul>

        <!-- Footer section -->
        <ul class="footer-list">
            <li style="cursor: pointer;">
                <a (click)="logoutmodal()">
                    <img src="/assets/icons/logout.svg" alt="logout">
                    <span *ngIf="!sidebarClosed">Logout</span>
                </a>
            </li>
        </ul>

    </nav>

    <!-- Main content -->
    <main class="content">
        <router-outlet></router-outlet>
    </main>

    <footer class="app-footer" [class.visible]="showFooter">
        <div class="footer-left">
            <span>Â© 2025 All Rights Reserved <span style="color: var(--primary-color1);">Datax</span></span>
        </div>
        <div class="footer-right">
            <a href="https://fourdotz.com/privacy-policy/" target="_blank">Privacy Policy</a> |
            <a href="https://fourdotz.com/terms-of-service/" target="_blank">Terms & Conditions</a> |
            <a href="https://fourdotz.com/refund-policy/" target="_blank">Refund Policy</a>
        </div>
    </footer>

</div>